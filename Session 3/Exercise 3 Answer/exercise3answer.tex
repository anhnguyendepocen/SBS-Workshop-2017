

\documentclass[12pt,a4paper]{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage{amsmath}
\usepackage{enumerate}
\usepackage[cm]{fullpage}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
\setlength\parindent{0cm}
%\setlength{\oddsidemargin}{0.25cm}
%\setlength{\evensidemargin}{0.25cm}
\title{\Large{\textbf{Introduction to \texttt{R}}}\\
\textit{Answers to Session 3 exercises}}
\author{Statistical Consulting Centre}
\date{1 March, 2017}
\maketitle
 

\section{Missing values}
\label{sec:missing}

\begin{enumerate}[(i)]
\item \label{itm:q1} In question 3(ii) of exercise 2 you identified the ``Can't choose'' cases in \texttt{q1a}. Now, replace these cases by
  \texttt{NA}.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{exclude.q1a} \hlkwb{<-} \hlkwd{which}\hlstd{(sports.df}\hlopt{$}\hlstd{q1a} \hlopt{==}  \hlstr{"Can?t choose"}\hlstd{)}
\hlstd{sports.df}\hlopt{$}\hlstd{q1a[exclude.q1a]} \hlkwb{=} \hlnum{NA}
\end{alltt}
\end{kframe}
\end{knitrout}
\item Repeat \ref{sec:missing}(\ref{itm:q1}) for \texttt{q1b} -- \texttt{q1e}, so that all cases of ``Can't choose'' are replaced by \texttt{NA}.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{exclude.q1b} \hlkwb{<-} \hlkwd{which}\hlstd{(sports.df}\hlopt{$}\hlstd{q1b} \hlopt{==}  \hlstr{"Can?t choose"}\hlstd{)}
\hlstd{sports.df}\hlopt{$}\hlstd{q1b[exclude.q1b]} \hlkwb{<-} \hlnum{NA}
\hlstd{exclude.q1c} \hlkwb{<-} \hlkwd{which}\hlstd{(sports.df}\hlopt{$}\hlstd{q1c} \hlopt{==}  \hlstr{"Can?t choose"}\hlstd{)}
\hlstd{sports.df}\hlopt{$}\hlstd{q1c[exclude.q1c]} \hlkwb{<-} \hlnum{NA}
\hlstd{exclude.q1d} \hlkwb{<-} \hlkwd{which}\hlstd{(sports.df}\hlopt{$}\hlstd{q1d} \hlopt{==}  \hlstr{"Can?t choose"}\hlstd{)}
\hlstd{sports.df}\hlopt{$}\hlstd{q1d[exclude.q1d]} \hlkwb{<-} \hlnum{NA}
\hlstd{exclude.q1e} \hlkwb{<-} \hlkwd{which}\hlstd{(sports.df}\hlopt{$}\hlstd{q1e} \hlopt{==}  \hlstr{"Can?t choose"}\hlstd{)}
\hlstd{sports.df}\hlopt{$}\hlstd{q1e[exclude.q1e]} \hlkwb{<-} \hlnum{NA}
\end{alltt}
\end{kframe}
\end{knitrout}
\item \label{it:1way-ethnicity} Produce a one-way frequency table of \texttt{ethnicity}.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{table}\hlstd{(sports.df}\hlopt{$}\hlstd{ethnicity)}
\end{alltt}
\begin{verbatim}

  China,Cantonese,Hakka,Mandarin            Europe,White/European 
                              19                              817 
 India,Hindi,Urdu,Gujarati,Tamil                Maori+New Zealand 
                               8                               90 
                   NA, dont know               Other,mixed origin 
                              11                               26 
PACIFIC,Polynesian,Chamorro/Guam 
                              25 
\end{verbatim}
\end{kframe}
\end{knitrout}
\item Repeat {\bf \ref{sec:missing}}(\ref{it:1way-ethnicity}) after replacing all cases of ``NA, dont know'' with \texttt{NA}.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{exclude.ethnicity} \hlkwb{<-} \hlkwd{which}\hlstd{(sports.df}\hlopt{$}\hlstd{ethnicity} \hlopt{==} \hlstr{"NA, dont know"}\hlstd{)}
\hlstd{sports.df}\hlopt{$}\hlstd{ethnicity[exclude.ethnicity]} \hlkwb{<-} \hlnum{NA}
\end{alltt}
\end{kframe}
\end{knitrout}
\item There are only two possible values for \texttt{partner}:
  \texttt{Yes} and \texttt{No}. Replace any values which are \underline{not} \texttt{Yes} or \texttt{No} with \texttt{NA}.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{exclude.partner} \hlkwb{<-} \hlkwd{with}\hlstd{(sports.df,} \hlkwd{which}\hlstd{(partner} \hlopt{!=} \hlstr{"Yes"} \hlopt{&} \hlstd{partner} \hlopt{!=}\hlstr{"No"}\hlstd{))}
\hlstd{sports.df}\hlopt{$}\hlstd{partner[exclude.partner]} \hlkwb{<-} \hlnum{NA}
\end{alltt}
\end{kframe}
\end{knitrout}


\end{enumerate}

\section{Factor}
\label{sec:fac}
\begin{enumerate}[(i)] 
\item Produce a two-way frequency table of \texttt{q1a} versus \texttt{gender}.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{with}\hlstd{(sports.df,} \hlkwd{table}\hlstd{(q1a, gender))}
\end{alltt}
\begin{verbatim}
                                    gender
q1a                                  Female Male
  CanÂ´t choose                          112  123
  Daily                                   1    1
  Several times a month                  44   22
  Several times a week                    4    4
  Several times a year or less often    352  297
\end{verbatim}
\end{kframe}
\end{knitrout}
\item Table \ref{tab:level} shows the appropriate ordering of the levels of the values in \texttt{q1a} -- \texttt{q1e}. \\
\begin{table}[!h]
  \centering
  \caption{The right levels for \texttt{q1a} to \texttt{q1e}}
  \begin{tabular}[h]{lr}
    q1a & Factor(q1a)\\
\hline
Daily & 1\\
Several times a week & 2\\
Several times a month & 3\\
Several times a year or less often & 4
  \end{tabular}
  \label{tab:level}
\end{table} \\
Convert \texttt{q1a} -- \texttt{q1e} into factors with their levels ordered as shown in Table \ref{tab:level}. Then generate two-way frequency tables between \texttt{q1a} to
\texttt{q1e}, respectively, versus \texttt{gender} to check that you've appropriately ordered these factors' levels.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{sports.df}\hlopt{$}\hlstd{q1a} \hlkwb{<-} \hlkwd{factor}\hlstd{(sports.df}\hlopt{$}\hlstd{q1a,}
                        \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Daily"}\hlstd{,} \hlstr{"Several times a week"}\hlstd{,}
                                   \hlstr{"Several times a month"}\hlstd{,}
                                   \hlstr{"Several times a year or less often"}\hlstd{))}
\hlkwd{with}\hlstd{(sports.df,} \hlkwd{table}\hlstd{(q1a, gender))}
\end{alltt}
\begin{verbatim}
                                    gender
q1a                                  Female Male
  Daily                                   1    1
  Several times a week                    4    4
  Several times a month                  44   22
  Several times a year or less often    352  297
\end{verbatim}
\begin{alltt}
\hlstd{sports.df}\hlopt{$}\hlstd{q1b} \hlkwb{<-} \hlkwd{factor}\hlstd{(sports.df}\hlopt{$}\hlstd{q1b,}
                        \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Daily"}\hlstd{,} \hlstr{"Several times a week"}\hlstd{,}
                                   \hlstr{"Several times a month"}\hlstd{,}
                                   \hlstr{"Several times a year or less often"}\hlstd{))}
\hlkwd{with}\hlstd{(sports.df,} \hlkwd{table}\hlstd{(q1b, gender))}
\end{alltt}
\begin{verbatim}
                                    gender
q1b                                  Female Male
  Daily                                   3    0
  Several times a week                    3    1
  Several times a month                  39   24
  Several times a year or less often    362  287
\end{verbatim}
\begin{alltt}
\hlstd{sports.df}\hlopt{$}\hlstd{q1c} \hlkwb{<-} \hlkwd{factor}\hlstd{(sports.df}\hlopt{$}\hlstd{q1c,}
                        \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Daily"}\hlstd{,} \hlstr{"Several times a week"}\hlstd{,}
                                   \hlstr{"Several times a month"}\hlstd{,}
                                   \hlstr{"Several times a year or less often"}\hlstd{))}
\hlkwd{with}\hlstd{(sports.df,} \hlkwd{table}\hlstd{(q1c, gender))}
\end{alltt}
\begin{verbatim}
                                    gender
q1c                                  Female Male
  Daily                                  21   14
  Several times a week                  184   93
  Several times a month                 224  213
  Several times a year or less often     81  113
\end{verbatim}
\begin{alltt}
\hlstd{sports.df}\hlopt{$}\hlstd{q1d} \hlkwb{<-} \hlkwd{factor}\hlstd{(sports.df}\hlopt{$}\hlstd{q1d,}
                        \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Daily"}\hlstd{,} \hlstr{"Several times a week"}\hlstd{,}
                                   \hlstr{"Several times a month"}\hlstd{,}
                                   \hlstr{"Several times a year or less often"}\hlstd{))}
\hlkwd{with}\hlstd{(sports.df,} \hlkwd{table}\hlstd{(q1d, gender))}
\end{alltt}
\begin{verbatim}
                                    gender
q1d                                  Female Male
  Daily                                  34   28
  Several times a week                  159  122
  Several times a month                 240  200
  Several times a year or less often     80   97
\end{verbatim}
\begin{alltt}
\hlstd{sports.df}\hlopt{$}\hlstd{q1e} \hlkwb{<-} \hlkwd{factor}\hlstd{(sports.df}\hlopt{$}\hlstd{q1e,}
                        \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Daily"}\hlstd{,} \hlstr{"Several times a week"}\hlstd{,}
                                   \hlstr{"Several times a month"}\hlstd{,}
                                   \hlstr{"Several times a year or less often"}\hlstd{))}
\hlkwd{with}\hlstd{(sports.df,} \hlkwd{table}\hlstd{(q1e, gender))}
\end{alltt}
\begin{verbatim}
                                    gender
q1e                                  Female Male
  Daily                                 136  108
  Several times a week                  220  151
  Several times a month                  89   98
  Several times a year or less often     48   62
\end{verbatim}
\end{kframe}
\end{knitrout}

\item \label{itm:group} Create a new variable which categorises all
  participants into one of three age groups: ``Under 40'', ``41 to 60'' and ``Over 61''.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{age.group} \hlkwb{<-} \hlkwd{with}\hlstd{(sports.df,} \hlkwd{ifelse}\hlstd{(age} \hlopt{<=} \hlnum{40}\hlstd{,} \hlstr{"Under 40"}\hlstd{,}
                             \hlkwd{ifelse}\hlstd{(age} \hlopt{>} \hlnum{40} \hlopt{&} \hlstd{age} \hlopt{<=}\hlnum{60}\hlstd{,} \hlstr{"41 to 60"}\hlstd{,} \hlstr{"Over 61"}\hlstd{)))}
\end{alltt}
\end{kframe}
\end{knitrout}

\item Convert the variable created in {\bf \ref{sec:fac}}(\ref{itm:group})
  into factors with appropriate levels.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{age.group} \hlkwb{<-} \hlkwd{factor}\hlstd{(age.group,} \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Under 40"}\hlstd{,} \hlstr{"41 to 60"}\hlstd{,} \hlstr{"Over 61"}\hlstd{))}
\end{alltt}
\end{kframe}
\end{knitrout}
\item Add the factor into \texttt{sports.df} and name it \texttt{age.group}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{sports.df}\hlopt{$}\hlstd{age.group} \hlkwb{<-} \hlstd{age.group}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{enumerate}
%\newpage
\section{Challenge}
\label{sec:cha}
We mentioned in Exercise 2 that the function \texttt{mystder} calculates
the standard error of the mean (SEM), i.e. 
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mystder} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)\{}
       \hlstd{mysd} \hlkwb{<-} \hlkwd{sd}\hlstd{(x,} \hlkwc{na.rm} \hlstd{= T)}
       \hlstd{n} \hlkwb{<-} \hlkwd{length}\hlstd{(x)}
       \hlstd{mysd}\hlopt{/}\hlkwd{sqrt}\hlstd{(n)}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
This function only calculates the standard error correctly if the input does NOT contain missing values. This is because the \texttt{length()} function counts the number of elements in the variable, including missing values. For example:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{test} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,} \hlnum{2}\hlstd{,} \hlnum{3}\hlstd{,} \hlnum{4}\hlstd{,} \hlnum{NA}\hlstd{)}
\hlkwd{length}\hlstd{(test)}
\end{alltt}
\begin{verbatim}
[1] 5
\end{verbatim}
\end{kframe}
\end{knitrout}
So, \texttt{length(test)} returns 5 instead of 4. Suppose you repeat an experiment 5 times, resulting in one missing value; your real/valid sample size is 4. Thus, when you calclate your standard error, use $n = 4$ instead of 5. For example,
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{mysd} \hlkwb{<-} \hlkwd{sd}\hlstd{(test,} \hlkwc{na.rm} \hlstd{= T)}
\hlstd{mysd}
\end{alltt}
\begin{verbatim}
[1] 1.290994
\end{verbatim}
\begin{alltt}
\hlstd{n} \hlkwb{<-} \hlnum{4}
\hlstd{n}
\end{alltt}
\begin{verbatim}
[1] 4
\end{verbatim}
\begin{alltt}
\hlstd{mysd}\hlopt{/}\hlkwd{sqrt}\hlstd{(n)}
\end{alltt}
\begin{verbatim}
[1] 0.6454972
\end{verbatim}
\end{kframe}
\end{knitrout}
The real SEM for \texttt{test} should be 0.6454972; however, if we use \texttt{mystder()} to calculate it we get:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{mystder}\hlstd{(test)}
\end{alltt}
\begin{verbatim}
[1] 0.5773503
\end{verbatim}
\end{kframe}
\end{knitrout}

Thus, calculating the sample size using \texttt{length()} will lead to an incorrect solution when there are missing values in the data. 
\begin{enumerate}[(i)] 
\item Now that you know what is wrong with \texttt{mystder()}, modify it so it gives the correct SEM even if the input contains missing values.  
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{#There are many many ways of doing this. Here is just one example:}
\hlstd{mystder} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{x}\hlstd{)\{}
       \hlstd{mysd} \hlkwb{<-} \hlkwd{sd}\hlstd{(x,} \hlkwc{na.rm} \hlstd{= T)}
       \hlstd{n} \hlkwb{<-} \hlkwd{sum}\hlstd{(}\hlopt{!}\hlkwd{is.na}\hlstd{(x))}
       \hlstd{mysd}\hlopt{/}\hlkwd{sqrt}\hlstd{(n)}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}
\item Apply your modified \texttt{mystder} function to \texttt{test} to see whether it returns the correct answer, i.e. 0.6454972.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{mystder}\hlstd{(test)}
\end{alltt}
\begin{verbatim}
[1] 0.6454972
\end{verbatim}
\end{kframe}
\end{knitrout}
\item Create \texttt{test2}, as shown below, and test your function on this new variable.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{test2} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{100}\hlstd{,} \hlkwd{rep}\hlstd{(}\hlnum{NA}\hlstd{,} \hlnum{30}\hlstd{))}
\hlkwd{mystder}\hlstd{(test2)}
\end{alltt}
\begin{verbatim}
[1] 2.901149
\end{verbatim}
\end{kframe}
\end{knitrout}
The correct value for the SEM should be 2.9011492.

\end{enumerate}
\end{document}
