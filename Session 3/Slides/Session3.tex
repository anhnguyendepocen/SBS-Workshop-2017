\documentclass{beamer}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0, 0, 0}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.533,0,0.133}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.667,0.267,0}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{1,0.533,0}{#1}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.4,0.067,0.067}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0,0,0.4}{\textbf{#1}}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0,0,0.4}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0,0.267,0.4}{#1}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{fancyvrb}
\usepackage{url}
\usetheme{Madrid}
\usecolortheme{beaver}
\setbeamertemplate{navigation symbols}{}
\titlegraphic{\includegraphics[width=5cm]{..//..//S-DS-VC-RGB.png}}
%\logo{\includegraphics[width=0.1\textwidth,keepaspectratio]{..//..//UOACrest.png}}
\author[SCC]{Statistical Consulting Centre}%\\
\institute[\href{mailto:consulting@stat.auckland.ac.nz}
  {consulting@stat.auckland.ac.nz}]{\href{mailto:consulting@stat.auckland.ac.nz}
  {consulting@stat.auckland.ac.nz}\\
%Statistical Consulting Centre\\
The Department of Statistics\\
The University of Auckland}
\title[Session 3 -- Data Manipulation]{NZSSN Courses: Introduction to \texttt{R}}
\subtitle{Session 3 --Data Manipulation}
\date{1 March, 2017}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
%\SweaveOpts{concordance=TRUE}
\maketitle
 
\begin{frame}[fragile]
  \frametitle{Data types}


  Everything in \texttt{R} is a vector (but some have only one
  element).
  \begin{enumerate}
  \item Numeric (same as double), or integer\\
    E.g. \texttt{Age}
  \item String (same as character), or categorical\\
    E.g. \texttt{Ethnicity}, \texttt{Gender}, \texttt{Q1 - Q8}.
\item Logical: \texttt{TRUE} or \texttt{FALSE}, e.g.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlnum{1} \hlopt{==} \hlnum{1}
\end{alltt}
\begin{verbatim}
[1] TRUE
\end{verbatim}
\begin{alltt}
\hlnum{2} \hlopt{<=} \hlnum{0}
\end{alltt}
\begin{verbatim}
[1] FALSE
\end{verbatim}
\begin{alltt}
\hlnum{3} \hlopt{!=} \hlnum{2}
\end{alltt}
\begin{verbatim}
[1] TRUE
\end{verbatim}
\end{kframe}
\end{knitrout}
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{table}\hlstd{(issp.df}\hlopt{$}\hlstd{Gender)}
\end{alltt}
\begin{verbatim}

     Female        Male NA, refused 
        607         418          22 
\end{verbatim}
\end{kframe}
\end{knitrout}
"NA, refused" means the information is unavailable. \texttt{R}'s \texttt{is.na()} tests for missing values. Let's try this for the 9th participant who had the value "NA, refused" Gender.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df[}\hlnum{9}\hlstd{,} \hlstr{"Gender"}\hlstd{]}
\end{alltt}
\begin{verbatim}
[1] "NA, refused"
\end{verbatim}
\begin{alltt}
\hlkwd{is.na}\hlstd{(issp.df[}\hlnum{9}\hlstd{,} \hlstr{"Gender"}\hlstd{])}
\end{alltt}
\begin{verbatim}
[1] FALSE
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
  \begin{itemize}
    \item \texttt{R} reserves the object \texttt{NA} (\texttt{N}ot \texttt{A}vailable) for elements of a vector that are missing or unavailable. 
    \item Use of \texttt{is.na()} to search for missing values requires that they are recorded as \texttt{NA}. 
    \item \texttt{na} will not do because \texttt{R} is case sensitive!
  \end{itemize}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{gender.na} \hlkwb{<-} \hlkwd{which}\hlstd{(issp.df}\hlopt{$}\hlstd{Gender} \hlopt{==} \hlstr{"NA, refused"}\hlstd{)}
\hlstd{gender.na}
\end{alltt}
\begin{verbatim}
 [1]    9   31   49   72   79   98  141  226  269
[10]  271  377  382  522  538  540  705  759  760
[19]  829  881 1025 1035
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Gender[gender.na]}
\end{alltt}
\begin{verbatim}
 [1] "NA, refused" "NA, refused" "NA, refused"
 [4] "NA, refused" "NA, refused" "NA, refused"
 [7] "NA, refused" "NA, refused" "NA, refused"
[10] "NA, refused" "NA, refused" "NA, refused"
[13] "NA, refused" "NA, refused" "NA, refused"
[16] "NA, refused" "NA, refused" "NA, refused"
[19] "NA, refused" "NA, refused" "NA, refused"
[22] "NA, refused"
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
Fix this:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Gender[gender.na]} \hlkwb{<-} \hlnum{NA}
\hlstd{issp.df}\hlopt{$}\hlstd{Gender[gender.na]}
\end{alltt}
\begin{verbatim}
 [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[16] NA NA NA NA NA NA NA
\end{verbatim}
\begin{alltt}
\hlstd{gender.missing} \hlkwb{<-} \hlkwd{is.na}\hlstd{(issp.df}\hlopt{$}\hlstd{Gender[gender.na])}
\hlstd{gender.missing}
\end{alltt}
\begin{verbatim}
 [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[10] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
[19] TRUE TRUE TRUE TRUE
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
How many cases of Gender are missing?
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# How many are missing?}
\hlkwd{sum}\hlstd{(gender.missing)}
\end{alltt}
\begin{verbatim}
[1] 22
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
  The default option of \texttt{table()} ignores \texttt{NA}s when constructing frequency tables. Now that all occurrences of \texttt{"NA, refused"} have been replaced with \texttt{NA}, missing values will no longer be shown in frequency tables constructed using \texttt{table()}. If you still want to see how many \texttt{NA}s in the frequency tables, you can change the \texttt{useNA} arguement to \texttt{"always"} in \texttt{table()}.
\begin{knitrout}\small
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{table}\hlstd{(issp.df}\hlopt{$}\hlstd{Gender)}
\end{alltt}
\begin{verbatim}

Female   Male 
   607    418 
\end{verbatim}
\begin{alltt}
\hlkwd{table}\hlstd{(issp.df}\hlopt{$}\hlstd{Gender,} \hlkwc{useNA} \hlstd{=} \hlstr{"always"}\hlstd{)}
\end{alltt}
\begin{verbatim}

Female   Male   <NA> 
   607    418     22 
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q6, Gender))}
\end{alltt}
\begin{verbatim}
                      Gender
Q6                     Female Male
  almost always wrong      36   13
  always wrong            109   63
  cant choose, dk          61   27
  na, refused               6    0
  not wrong at all        317  259
  only sometimes wrong     78   56
\end{verbatim}
\end{kframe}
\end{knitrout}
``na, refused'' should be treated as missing values.
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# Case (row) numbers for which Q6 contains "na, refused"}
\hlstd{Q6.na} \hlkwb{<-} \hlkwd{which}\hlstd{(issp.df}\hlopt{$}\hlstd{Q6} \hlopt{==} \hlstr{"na, refused"}\hlstd{)}
\hlstd{Q6.na}
\end{alltt}
\begin{verbatim}
[1]   9  25  96 141 267 383 518 538 940
\end{verbatim}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q6[Q6.na]}
\end{alltt}
\begin{verbatim}
[1] "na, refused" "na, refused" "na, refused"
[4] "na, refused" "na, refused" "na, refused"
[7] "na, refused" "na, refused" "na, refused"
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# Set cases with "na, refused" in Q6 to NA}
\hlstd{issp.df}\hlopt{$}\hlstd{Q6[Q6.na]} \hlkwb{<-} \hlnum{NA}

\hlcom{# Re-print the table}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q6, Gender))}
\end{alltt}
\begin{verbatim}
                      Gender
Q6                     Female Male
  almost always wrong      36   13
  always wrong            109   63
  cant choose, dk          61   27
  not wrong at all        317  259
  only sometimes wrong     78   56
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}
  \frametitle{\texttt{factor}}
  \begin{block}{What is a factor?}
    \textit{A variable which takes either qualitative values, ordinal values or a discrete set of quantitative values. The values of a factor are called its {\em levels}.}
  \end{block}
Examples of factors:  
\begin{itemize}
  \item \texttt{Gender} with 2 {\em qualitative} levels: \texttt{Male} and \texttt{Female}.
  \item \texttt{Education} with 6 {\em ordinal} levels: \texttt{None} $<$ \texttt{"Primary compl} $<$ \texttt{Incpl secondary} $<$ \texttt{Secondary compl} $<$ \texttt{Incpl university} $<$ \texttt{University degree}.
  \item \texttt{Income} has 9 {\em quantitative} levels when the mid-values of the income ranges are used: \texttt{5000}, \texttt{12500}, \texttt{17500}, \texttt{22500}, \texttt{27500}, \texttt{35000}, \texttt{45000}, \texttt{60000} and \texttt{85000}.
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{levels}\hlstd{(}\hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q6))}
\end{alltt}
\begin{verbatim}
[1] "almost always wrong"  "always wrong"        
[3] "cant choose, dk"      "not wrong at all"    
[5] "only sometimes wrong"
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}
  \frametitle{Factor}
\begin{itemize}
  \item \texttt{R} stores two {\em additional} pieces of information for each factor: (1) the unique set of levels and (2) an integer value, assigned by \texttt{R}, for each unique level. 
  \item The integer values are assigned to factor levels so that they have an order associated with them.
  \item By default, the unique levels are assigned the values 1, 2,..., according to ascending alphabetical order. This is not always appropriate! 
  \item Example: Consider the factor \texttt{issp.df\$Q6}
\end{itemize}
\begin{table}[h]
  \centering
  \begin{tabular}[h]{lr}
    Level  & Default order \\
    \hline
    almost always wrong  & 1\\
    always wrong         & 2\\
    cant choose, dk      & 3\\ 
    only sometimes wrong & 4\\
    not wrong at all     & 5\\
    \hline
  \end{tabular}
\end{table}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Factor}
  Specify order using \texttt{levels} argument, i.e.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q6} \hlkwb{<-} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q6,}
                     \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"always wrong"}\hlstd{,}
                                \hlstr{"almost always wrong"}\hlstd{,}
                                \hlstr{"only sometimes wrong"}\hlstd{,}
                                \hlstr{"not wrong at all"}\hlstd{,}
                                \hlstr{"cant choose, dk"}\hlstd{))}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q6, Gender))}
\end{alltt}
\begin{verbatim}
                      Gender
Q6                     Female Male
  always wrong            109   63
  almost always wrong      36   13
  only sometimes wrong     78   56
  not wrong at all        317  259
  cant choose, dk          61   27
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Repeat for Q7 and Q8}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{Q7.na} \hlkwb{<-} \hlkwd{which}\hlstd{(issp.df}\hlopt{$}\hlstd{Q7} \hlopt{==} \hlstr{"na, refused"}\hlstd{)}
\hlstd{issp.df}\hlopt{$}\hlstd{Q7[Q7.na]} \hlkwb{<-} \hlnum{NA}
\hlstd{issp.df}\hlopt{$}\hlstd{Q7} \hlkwb{=} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q7,} \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"always wrong"}\hlstd{,}
            \hlstr{"almost always wrong"}\hlstd{,} \hlstr{"only sometimes wrong"}\hlstd{,}
            \hlstr{"not wrong at all"}\hlstd{,} \hlstr{"cant choose, dk"}\hlstd{))}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q7, Gender))}
\end{alltt}
\begin{verbatim}
                      Gender
Q7                     Female Male
  always wrong            417  258
  almost always wrong      97   78
  only sometimes wrong     46   30
  not wrong at all         13   23
  cant choose, dk          27   29
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Repeat for Q7 and Q8}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{Q8.na} \hlkwb{<-} \hlkwd{which}\hlstd{(issp.df}\hlopt{$}\hlstd{Q8} \hlopt{==} \hlstr{"na, refused"}\hlstd{)}
\hlstd{issp.df}\hlopt{$}\hlstd{Q8[Q8.na]} \hlkwb{<-} \hlnum{NA}
\hlstd{issp.df}\hlopt{$}\hlstd{Q8} \hlkwb{=} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q8,} \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"always wrong"}\hlstd{,}
            \hlstr{"almost always wrong"}\hlstd{,} \hlstr{"only sometimes wrong"}\hlstd{,}
            \hlstr{"not wrong at all"}\hlstd{,} \hlstr{"cant choose, dk"}\hlstd{))}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q8, Gender))}
\end{alltt}
\begin{verbatim}
                      Gender
Q8                     Female Male
  always wrong            456  283
  almost always wrong      89   83
  only sometimes wrong     29   30
  not wrong at all          4    9
  cant choose, dk          24   13
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Q1 to Q4}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q1, Gender))}
\end{alltt}
\begin{verbatim}
                       Gender
Q1                      Female Male
  agree                    162  131
  cant choose, dk           15    5
  disagree                 157   96
  na, refused               12    2
  neither agree nor dis    188  139
  strongly agree            62   35
  strongly disagree         11   10
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tidy up Q1}
This time we will treat both "na, refused" and "cant choose, dk" as missing values.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{Q1.na} \hlkwb{<-} \hlkwd{which}\hlstd{(issp.df}\hlopt{$}\hlstd{Q1} \hlopt{==} \hlstr{"na, refused"} \hlopt{|}
              \hlstd{issp.df}\hlopt{$}\hlstd{Q1} \hlopt{==} \hlstr{"can't choose, dk"}\hlstd{)}
\hlstd{issp.df}\hlopt{$}\hlstd{Q1[Q1.na]} \hlkwb{<-} \hlnum{NA}
\end{alltt}
\end{kframe}
\end{knitrout}
\vspace{-2mm}
The pipe symbol `\texttt{|}' is read as `or'.\\
\vspace{4mm}
Convert \texttt{Q1} to a \texttt{factor} with appropriately ordered levels, i.e.
\vspace{-2mm}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q1} \hlkwb{<-} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q1,}
                     \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"strongly agree"}\hlstd{,}
                    \hlstr{"agree"}\hlstd{,} \hlstr{"neither agree nor dis"}\hlstd{,}
                    \hlstr{"disagree"}\hlstd{,} \hlstr{"strongly disagree"}\hlstd{))}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}
\begin{frame}[fragile]
  \frametitle{Always check whether \texttt{R} has done the right thing!}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q1, Gender))}
\end{alltt}
\begin{verbatim}
                       Gender
Q1                      Female Male
  strongly agree            62   35
  agree                    162  131
  neither agree nor dis    188  139
  disagree                 157   96
  strongly disagree         11   10
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Binning ages into age groups}
Sometimes we are interested in examining responses by age group. The \texttt{ifelse()} function provides a quick way of doing binning ages into age groups, i.e.
\begin{figure}
\centering
\begin{BVerbatim}
  ifelse(test, yes, no)
\end{BVerbatim}
\end{figure}
\begin{itemize}
  \item \texttt{test}: a logical test.
  \item \texttt{yes}, what happens if the test is True.
  \item \texttt{no}, what happens if the test is False.
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{\texttt{ifelse()}}
{\bf Example.} Consider the ages of the first 10 participants.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{test1} \hlkwb{<-} \hlstd{issp.df}\hlopt{$}\hlstd{Age[}\hlnum{1}\hlopt{:}\hlnum{10}\hlstd{]}
\hlstd{test1}
\end{alltt}
\begin{verbatim}
 [1] 56 45 38 33 37 27 43 24 NA 22
\end{verbatim}
\begin{alltt}
\hlstd{test1} \hlopt{<} \hlnum{30}
\end{alltt}
\begin{verbatim}
 [1] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
 [8]  TRUE    NA  TRUE
\end{verbatim}
\begin{alltt}
\hlkwd{ifelse}\hlstd{(test1}\hlopt{<=}\hlnum{30}\hlstd{,} \hlstr{"Under 30"}\hlstd{,} \hlstr{"Over 31"}\hlstd{)}
\end{alltt}
\begin{verbatim}
 [1] "Over 31"  "Over 31"  "Over 31"  "Over 31" 
 [5] "Over 31"  "Under 30" "Over 31"  "Under 30"
 [9] NA         "Under 30"
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{\texttt{ifelse()}}
What about {\em three} age groups?\\
\vspace{5mm}
Nest one \texttt{ifelse()} inside another. E.g.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{test1}
\end{alltt}
\begin{verbatim}
 [1] 56 45 38 33 37 27 43 24 NA 22
\end{verbatim}
\begin{alltt}
\hlkwd{ifelse}\hlstd{(test1}\hlopt{<=}\hlnum{30}\hlstd{,} \hlstr{"Under 30"}\hlstd{,}
       \hlkwd{ifelse}\hlstd{(test1} \hlopt{<=} \hlnum{40}\hlstd{,} \hlstr{"31 to 40"}\hlstd{,} \hlstr{"Over 40"}\hlstd{))}
\end{alltt}
\begin{verbatim}
 [1] "Over 40"  "Over 40"  "31 to 40" "31 to 40"
 [5] "31 to 40" "Under 30" "Over 40"  "Under 30"
 [9] NA         "Under 30"
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}
\begin{frame}[fragile]
  \frametitle{\texttt{ifelse()}}
Now, assign each of the 1047 respondents to one of three age groups: "Under 35", "36 to 60" and "Over 61".
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{age.group} \hlkwb{<-}
  \hlkwd{ifelse}\hlstd{(issp.df}\hlopt{$}\hlstd{Age}\hlopt{<=}\hlnum{35}\hlstd{,} \hlstr{"Under 35"}\hlstd{,}
         \hlkwd{ifelse}\hlstd{(issp.df}\hlopt{$}\hlstd{Age} \hlopt{<=} \hlnum{60}\hlstd{,} \hlstr{"36 to 60"}\hlstd{,} \hlstr{"Over 61"}\hlstd{))}
\hlkwd{table}\hlstd{(issp.df}\hlopt{$}\hlstd{age.group)}
\end{alltt}
\begin{verbatim}

36 to 60  Over 61 Under 35 
     470      218      333 
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{\texttt{ifelse()}}
Convert \texttt{age.group} to a \texttt{factor} with levels in ascending order.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{age.group} \hlkwb{<-} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{age.group,}
                           \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Under 35"}\hlstd{,}
                                      \hlstr{"36 to 60"}\hlstd{,}
                                      \hlstr{"Over 61"}\hlstd{))}
\hlkwd{table}\hlstd{(issp.df}\hlopt{$}\hlstd{age.group)}
\end{alltt}
\begin{verbatim}

Under 35 36 to 60  Over 61 
     333      470      218 
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Using \texttt{ifelse()} to tidy up \texttt{Q2} -- \texttt{Q4}}
Use \texttt{ifelse()} to replace "na, refused" and "cant choose, dk" with \texttt{NA}s.
\vspace{-2mm}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q2[}\hlnum{7}\hlopt{:}\hlnum{12}\hlstd{]}
\end{alltt}
\end{kframe}
\end{knitrout}
\vspace{-5mm}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{verbatim}
[1] "neither agree nor dis"
[2] "strongly disagree"    
[3] "na, refused"          
[4] "strongly disagree"    
[5] "disagree"             
[6] "agree"                
\end{verbatim}
\end{kframe}
\end{knitrout}
\vspace{-2mm}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# Create logical (TRUE/FALSE) variable of cases }
\hlcom{# to replace with NA}
\hlstd{make.na} \hlkwb{<-} \hlstd{(issp.df}\hlopt{$}\hlstd{Q2} \hlopt{==} \hlstr{"cant choose, dk"} \hlopt{|}
            \hlstd{issp.df}\hlopt{$}\hlstd{Q2} \hlopt{==} \hlstr{"na, refused"}\hlstd{)}
\hlstd{make.na[}\hlnum{7}\hlopt{:}\hlnum{12}\hlstd{]}
\end{alltt}
\end{kframe}
\end{knitrout}
\vspace{-5mm}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{verbatim}
[1] FALSE FALSE  TRUE FALSE FALSE FALSE
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Using \texttt{ifelse()} to tidy up \texttt{Q2} -- \texttt{Q4}}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q2} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(make.na,} \hlnum{NA}\hlstd{, issp.df}\hlopt{$}\hlstd{Q2)}
\hlstd{issp.df}\hlopt{$}\hlstd{Q2[}\hlnum{7}\hlopt{:}\hlnum{12}\hlstd{]}
\end{alltt}
\begin{verbatim}
[1] "neither agree nor dis"
[2] "strongly disagree"    
[3] NA                     
[4] "strongly disagree"    
[5] "disagree"             
[6] "agree"                
\end{verbatim}
\end{kframe}
\end{knitrout}
Translation: If \texttt{make.na} is \texttt{TRUE} (i.e. cases for which \texttt{Q2} is "cant choose, dk" or "na, refused"), then replace that case in \texttt{Q2} with \texttt{NA}, otherwise leave it as is.
\end{frame}


\begin{frame}[fragile]
  \frametitle{Using \texttt{ifelse()} to tidy up \texttt{Q2} -- \texttt{Q4}}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q2} \hlkwb{<-} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q2,}
                    \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"strongly agree"}\hlstd{,}
                    \hlstr{"agree"}\hlstd{,} \hlstr{"neither agree nor dis"}\hlstd{,}
                    \hlstr{"disagree"}\hlstd{,} \hlstr{"strongly disagree"}\hlstd{))}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q2, age.group))}
\end{alltt}
\begin{verbatim}
                       age.group
Q2                      Under 35 36 to 60 Over 61
  strongly agree               7       12      21
  agree                       23       87      83
  neither agree nor dis       46       81      41
  disagree                   134      192      56
  strongly disagree          119       88       6
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Using \texttt{ifelse()} to tidy up \texttt{Q2} -- \texttt{Q4}}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{issp.df}\hlopt{$}\hlstd{Q3} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(issp.df}\hlopt{$}\hlstd{Q3} \hlopt{==} \hlstr{"cant choose, dk"} \hlopt{|}
                     \hlstd{issp.df}\hlopt{$}\hlstd{Q3} \hlopt{==} \hlstr{"na, refused"}\hlstd{,}
                     \hlnum{NA}\hlstd{, issp.df}\hlopt{$}\hlstd{Q3)}
\hlstd{issp.df}\hlopt{$}\hlstd{Q3} \hlkwb{<-} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q3,}
                    \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"strongly agree"}\hlstd{,}
                    \hlstr{"agree"}\hlstd{,} \hlstr{"neither agree nor dis"}\hlstd{,}
                    \hlstr{"disagree"}\hlstd{,} \hlstr{"strongly disagree"}\hlstd{))}
\hlstd{issp.df}\hlopt{$}\hlstd{Q4} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(issp.df}\hlopt{$}\hlstd{Q4} \hlopt{==} \hlstr{"cant choose, dk"} \hlopt{|}
                     \hlstd{issp.df}\hlopt{$}\hlstd{Q4} \hlopt{==} \hlstr{"na, refused"}\hlstd{,}
                     \hlnum{NA}\hlstd{, issp.df}\hlopt{$}\hlstd{Q4)}
\hlstd{issp.df}\hlopt{$}\hlstd{Q4} \hlkwb{<-} \hlkwd{factor}\hlstd{(issp.df}\hlopt{$}\hlstd{Q4,}
                    \hlkwc{levels} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"strongly agree"}\hlstd{,}
                    \hlstr{"agree"}\hlstd{,} \hlstr{"neither agree nor dis"}\hlstd{,}
                    \hlstr{"disagree"}\hlstd{,} \hlstr{"strongly disagree"}\hlstd{))}
\end{alltt}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Using \texttt{ifelse()} to tidy up \texttt{Q2} -- \texttt{Q4}}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q3, age.group))}
\end{alltt}
\begin{verbatim}
                       age.group
Q3                      Under 35 36 to 60 Over 61
  strongly agree               8       11       8
  agree                       16       54      63
  neither agree nor dis       27       75      45
  disagree                   164      227      83
  strongly disagree          116       93       9
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Using \texttt{ifelse()} to tidy up \texttt{Q2} -- \texttt{Q4}}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.965, 0.965, 0.965}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{with}\hlstd{(issp.df,} \hlkwd{table}\hlstd{(Q4, age.group))}
\end{alltt}
\begin{verbatim}
                       age.group
Q4                      Under 35 36 to 60 Over 61
  strongly agree              25       54      30
  agree                      179      304     139
  neither agree nor dis       65       55      21
  disagree                    52       49      21
  strongly disagree            7        2       2
\end{verbatim}
\end{kframe}
\end{knitrout}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Summary}
  \begin{itemize}
  \item Missing values
  \item Factor
  \item Subsetting vectors and datasets
  \item \texttt{ifelse()}
  \end{itemize}
\end{frame}

\end{document}
 
