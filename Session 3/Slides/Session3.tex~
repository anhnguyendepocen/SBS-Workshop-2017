\documentclass{beamer}\usepackage{graphicx, color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.2, 0.2, 0.2}
\newcommand{\hlnumber}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlfunctioncall}[1]{\textcolor[rgb]{0.501960784313725,0,0.329411764705882}{\textbf{#1}}}%
\newcommand{\hlstring}[1]{\textcolor[rgb]{0.6,0.6,1}{#1}}%
\newcommand{\hlkeyword}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlargument}[1]{\textcolor[rgb]{0.690196078431373,0.250980392156863,0.0196078431372549}{#1}}%
\newcommand{\hlcomment}[1]{\textcolor[rgb]{0.180392156862745,0.6,0.341176470588235}{#1}}%
\newcommand{\hlroxygencomment}[1]{\textcolor[rgb]{0.43921568627451,0.47843137254902,0.701960784313725}{#1}}%
\newcommand{\hlformalargs}[1]{\textcolor[rgb]{0.690196078431373,0.250980392156863,0.0196078431372549}{#1}}%
\newcommand{\hleqformalargs}[1]{\textcolor[rgb]{0.690196078431373,0.250980392156863,0.0196078431372549}{#1}}%
\newcommand{\hlassignement}[1]{\textcolor[rgb]{0,0,0}{\textbf{#1}}}%
\newcommand{\hlpackage}[1]{\textcolor[rgb]{0.588235294117647,0.709803921568627,0.145098039215686}{#1}}%
\newcommand{\hlslot}[1]{\textit{#1}}%
\newcommand{\hlsymbol}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlprompt}[1]{\textcolor[rgb]{0.2,0.2,0.2}{#1}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{url}
\usetheme{Warsaw}
\setbeamertemplate{navigation symbols}{}
\logo{\includegraphics[width=0.1\textwidth,keepaspectratio]{..//..//UOACrest.png}}
\author[SCC]{Statistical Consulting Center}%\\
\institute{\href{mailto:consulting@stat.auckland.ac.nz}
  {consulting@stat.auckland.ac.nz}\\
%Statistical Consulting Centre\\
The Department of Statistics\\
The University of Auckland}
\title[\hspace{2em}\insertframenumber/\inserttotalframenumber]{NZSSN Courses: Introduction
to \texttt{R}}
\subtitle{Data Manipulation}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
%\SweaveOpts{concordance=TRUE}
\maketitle
 
\begin{frame}[fragile]
  \frametitle{Data types}



  Everything in \texttt{R} is a vector (but some have only one
  element).
  \begin{enumerate}
  \item Numeric, including integer\\
    E.g. \texttt{Age}
  \item String, or categorical\\
    E.g. \texttt{Ethnicity}, \texttt{Gender}, \texttt{Q1 - Q8}.
\item Logical: \texttt{TRUE} or \texttt{FALSE}, e.g.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
1 == 1
\end{alltt}
\begin{verbatim}
## [1] TRUE
\end{verbatim}
\begin{alltt}
2 <= 0
\end{alltt}
\begin{verbatim}
## [1] FALSE
\end{verbatim}
\begin{alltt}
3 != 2
\end{alltt}
\begin{verbatim}
## [1] TRUE
\end{verbatim}
\end{kframe}
\end{knitrout}

  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlfunctioncall{table}(issp.df$Gender)
\end{alltt}
\begin{verbatim}
## 
##      Female        Male NA, refused 
##         607         418          22
\end{verbatim}
\end{kframe}
\end{knitrout}

"NA, refused" should be treated as missing values. We can use \texttt{is.na()} to test this. For example, the 9th participants had "NA, refused" under Gender.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
issp.df[9, \hlstring{"Gender"}]
\end{alltt}
\begin{verbatim}
## [1] "NA, refused"
\end{verbatim}
\begin{alltt}
\hlfunctioncall{is.na}(issp.df[9, \hlstring{"Gender"}])
\end{alltt}
\begin{verbatim}
## [1] FALSE
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
????How????\\
The string for missing value in \texttt{R} is \texttt{NA}, not anything else, not even \texttt{na}!



\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
gender.na <- \hlfunctioncall{which}(issp.df$Gender == \hlstring{"NA, refused"})
gender.na
\end{alltt}
\begin{verbatim}
##  [1]    9   31   49   72   79   98  141  226  269
## [10]  271  377  382  522  538  540  705  759  760
## [19]  829  881 1025 1035
\end{verbatim}
\begin{alltt}
issp.df$Gender[gender.na]
\end{alltt}
\begin{verbatim}
##  [1] "NA, refused" "NA, refused" "NA, refused"
##  [4] "NA, refused" "NA, refused" "NA, refused"
##  [7] "NA, refused" "NA, refused" "NA, refused"
## [10] "NA, refused" "NA, refused" "NA, refused"
## [13] "NA, refused" "NA, refused" "NA, refused"
## [16] "NA, refused" "NA, refused" "NA, refused"
## [19] "NA, refused" "NA, refused" "NA, refused"
## [22] "NA, refused"
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
Fix this:
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
issp.df$Gender[gender.na] = NA
issp.df$Gender[gender.na]
\end{alltt}
\begin{verbatim}
##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
## [16] NA NA NA NA NA NA NA
\end{verbatim}
\begin{alltt}
\hlfunctioncall{is.na}(issp.df$Gender[gender.na])
\end{alltt}
\begin{verbatim}
##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [10] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [19] TRUE TRUE TRUE TRUE
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
Missing values will no longer be shown in \texttt{table()}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlfunctioncall{table}(issp.df$Gender)
\end{alltt}
\begin{verbatim}
## 
## Female   Male 
##    607    418
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q6, Gender))
\end{alltt}
\begin{verbatim}
##                       Gender
## Q6                     Female Male
##   almost always wrong      36   13
##   always wrong            109   63
##   cant choose, dk          61   27
##   na, refused               6    0
##   not wrong at all        317  259
##   only sometimes wrong     78   56
\end{verbatim}
\end{kframe}
\end{knitrout}

"cant choose, dk" should be treated as missing values.
\end{frame}

\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
Q6.na <- \hlfunctioncall{which}(issp.df$Q6 == \hlstring{"na, refused"})
Q6.na
\end{alltt}
\begin{verbatim}
## [1]   9  25  96 141 267 383 518 538 940
\end{verbatim}
\begin{alltt}
issp.df$Q6[Q6.na]
\end{alltt}
\begin{verbatim}
## [1] "na, refused" "na, refused" "na, refused"
## [4] "na, refused" "na, refused" "na, refused"
## [7] "na, refused" "na, refused" "na, refused"
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}


\begin{frame}[fragile]
  \frametitle{Missing values}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
issp.df$Q6[Q6.na] = NA
issp.df$Q6[Q6.na]
\end{alltt}
\begin{verbatim}
## [1] NA NA NA NA NA NA NA NA NA
\end{verbatim}
\begin{alltt}
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q6, Gender))
\end{alltt}
\begin{verbatim}
##                       Gender
## Q6                     Female Male
##   almost always wrong      36   13
##   always wrong            109   63
##   cant choose, dk          61   27
##   not wrong at all        317  259
##   only sometimes wrong     78   56
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}

\begin{frame}
  \frametitle{Factor}
\begin{itemize}
\item Jargon:\\
Factors in \texttt{R} are stored as a vector of integer values with a corresponding set of character values to use when the factor is displayed. 
\item Common language:\\
Assign levels/rankings to a categorical variable.
\end{itemize}
\begin{table}[h]
  \centering
  \begin{tabular}[h]{lr}
    Q6 & Factor(Q6)\\
\hline
always wrong & 1\\
almost always wrong & 2\\
only sometimes wrong & 3\\
not wrong at all & 4\\
cant choose, dk &5 
  \end{tabular}
\end{table}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Factor}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
issp.df$Q6 = \hlfunctioncall{factor}(issp.df$Q6, levels = \hlfunctioncall{c}(\hlstring{"always wrong"}, 
    \hlstring{"almost always wrong"}, \hlstring{"only sometimes wrong"}, 
    \hlstring{"not wrong at all"}, \hlstring{"cant choose, dk"}))
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q6, Gender))
\end{alltt}
\begin{verbatim}
##                       Gender
## Q6                     Female Male
##   always wrong            109   63
##   almost always wrong      36   13
##   only sometimes wrong     78   56
##   not wrong at all        317  259
##   cant choose, dk          61   27
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}

\begin{frame}[fragile]
  \frametitle{Do the same thing for Q7 and Q8}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
Q7.na <- \hlfunctioncall{which}(issp.df$Q7 == \hlstring{"na, refused"})
issp.df$Q7[Q7.na] <- NA
issp.df$Q7 = \hlfunctioncall{factor}(issp.df$Q7, levels = \hlfunctioncall{c}(\hlstring{"always wrong"}, 
    \hlstring{"almost always wrong"}, \hlstring{"only sometimes wrong"}, 
    \hlstring{"not wrong at all"}, \hlstring{"cant choose, dk"}))
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q7, Gender))
\end{alltt}
\begin{verbatim}
##                       Gender
## Q7                     Female Male
##   always wrong            417  258
##   almost always wrong      97   78
##   only sometimes wrong     46   30
##   not wrong at all         13   23
##   cant choose, dk          27   29
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}

\begin{frame}[fragile]
  \frametitle{Do the same thing for Q7 and Q8}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
Q8.na <- \hlfunctioncall{which}(issp.df$Q8 == \hlstring{"na, refused"})
issp.df$Q8[Q8.na] <- NA
issp.df$Q8 = \hlfunctioncall{factor}(issp.df$Q8, levels = \hlfunctioncall{c}(\hlstring{"always wrong"}, 
    \hlstring{"almost always wrong"}, \hlstring{"only sometimes wrong"}, 
    \hlstring{"not wrong at all"}, \hlstring{"cant choose, dk"}))
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q8, Gender))
\end{alltt}
\begin{verbatim}
##                       Gender
## Q8                     Female Male
##   always wrong            456  283
##   almost always wrong      89   83
##   only sometimes wrong     29   30
##   not wrong at all          4    9
##   cant choose, dk          24   13
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}


\begin{frame}[fragile]
  \frametitle{Q1 to Q4}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q1, Gender))
\end{alltt}
\begin{verbatim}
##                        Gender
## Q1                      Female Male
##   agree                    162  131
##   cant choose, dk           15    5
##   disagree                 157   96
##   na, refused               12    2
##   neither agree nor dis    188  139
##   strongly agree            62   35
##   strongly disagree         11   10
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}

\begin{frame}[fragile]
  \frametitle{Tidy up Q1}
This time, I will treat both "na, refused" and "cant choose, dk" as missing values.
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
Q1.na <- \hlfunctioncall{which}(issp.df$Q1 == \hlstring{"na, refused"} | issp.df$Q1 == 
    \hlstring{"can't choose, dk"})
issp.df$Q1[Q1.na] <- NA
\end{alltt}
\end{kframe}
\end{knitrout}

Then give it the right order
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
issp.df$Q1 = \hlfunctioncall{factor}(issp.df$Q1, 
                    levels = \hlfunctioncall{c}(\hlstring{"strongly agree"}, 
                    \hlstring{"agree"}, \hlstring{"neither agree nor dis"}, 
                    \hlstring{"disagree"}, \hlstring{"strongly disagree"}))
\end{alltt}
\end{kframe}
\end{knitrout}

\end{frame}
\begin{frame}[fragile]
  \frametitle{Always check whether \texttt{R} has done the right thing!}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlfunctioncall{with}(issp.df, \hlfunctioncall{table}(Q1, Gender))
\end{alltt}
\begin{verbatim}
##                        Gender
## Q1                      Female Male
##   strongly agree            62   35
##   agree                    162  131
##   neither agree nor dis    188  139
##   disagree                 157   96
##   strongly disagree         11   10
\end{verbatim}
\begin{alltt}
\hlfunctioncall{as.numeric}(issp.df$Q1[1:10])
\end{alltt}
\begin{verbatim}
##  [1]  4  5  4 NA  4  4  1  3 NA  4
\end{verbatim}
\end{kframe}
\end{knitrout}

\end{frame}

\begin{frame}
  \frametitle{Turning age into age groups}
Sometimes we are more interested in the age group rather than age. The function \texttt{ifelse()} provides a quick way of doing it.
\begin{verbatim}
-> ifelse(test, yes, no)
\end{verbatim}
  \begin{itemize}
  \item \texttt{test}: a logical test.
  \item \texttt{yes}, what happens if the test is True.
  \item \texttt{no}, what happens if the test is False.
  \end{itemize}
\end{frame}
\end{document}
 
